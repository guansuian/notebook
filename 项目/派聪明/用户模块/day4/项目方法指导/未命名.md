```Mermaid
  flowchart TD
    %% Public APIs
    generateToken --> getSigningKey
    generateToken --> generateTokenId
    generateToken --> userRepository_findByUsername[UserRepository.findByUsername]
    generateToken --> tokenCacheService_cacheToken[TokenCacheService.cacheToken]

    generateRefreshToken --> getSigningKey
    generateRefreshToken --> generateTokenId                                                                                                                                                                            
    generateRefreshToken --> userRepository_findByUsername                                                                                                                                                              
    generateRefreshToken --> tokenCacheService_cacheRefreshToken[TokenCacheService.cacheRefreshToken]                                                                                                                   
                                                                                                                                                                                                                        
    validateToken --> extractTokenIdFromToken                                                                                                                                                                           
    validateToken --> tokenCacheService_isTokenValid[TokenCacheService.isTokenValid]                                                                                                                                    
    validateToken --> getSigningKey                                                                                                                                                                                     
                                                                                                                                                                                                                        
    validateRefreshToken --> extractRefreshTokenIdFromToken                                                                                                                                                             
    validateRefreshToken --> tokenCacheService_isRefreshTokenValid[TokenCacheService.isRefreshTokenValid]                                                                                                               
    validateRefreshToken --> getSigningKey                                                                                                                                                                              
                                                                                                                                                                                                                        
    extractUsernameFromToken --> extractClaimsIgnoreExpiration                                                                                                                                                          
    extractUserIdFromToken --> extractClaimsIgnoreExpiration                                                                                                                                                            
    extractRoleFromToken --> extractClaimsIgnoreExpiration                                                                                                                                                              
    extractOrgTagsFromToken --> extractClaimsIgnoreExpiration                                                                                                                                                           
    extractPrimaryOrgFromToken --> extractClaimsIgnoreExpiration                                                                                                                                                        
                                                                                                                                                                                                                        
    shouldRefreshToken --> extractClaims                                                                                                                                                                                
    canRefreshExpiredToken --> extractClaimsIgnoreExpiration                                                                                                                                                            
                                                                                                                                                                                                                        
    refreshToken --> extractClaimsIgnoreExpiration                                                                                                                                                                      
    refreshToken --> generateToken                                                                                                                                                                                      
                                                                                                                                                                                                                        
    extractTokenIdFromToken --> extractClaimsIgnoreExpiration                                                                                                                                                           
    extractRefreshTokenIdFromToken --> extractClaimsIgnoreExpiration                                                                                                                                                    
                                                                                                                                                                                                                        
    invalidateToken --> extractTokenIdFromToken                                                                                                                                                                         
    invalidateToken --> extractClaimsIgnoreExpiration                                                                                                                                                                   
    invalidateToken --> tokenCacheService_blacklistToken[TokenCacheService.blacklistToken]                                                                                                                              
    invalidateToken --> tokenCacheService_removeToken[TokenCacheService.removeToken]                                                                                                                                    
                                                                                                                                                                                                                        
    invalidateAllUserTokens --> tokenCacheService_removeAllUserTokens[TokenCacheService.removeAllUserTokens]                                                                                                            
                                                                                                                                                                                                                        
    %% Private helpers                                                                                                                                                                                                  
    extractClaimsIgnoreExpiration --> getSigningKey                                                                                                                                                                     
    extractClaims --> getSigningKey     

```