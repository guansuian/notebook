# 作用

>比如说一个用户有多个设备，假设他的token被攻击，一般是攻击长token，为了确保攻击者不会从这个用户的其他设备拿到长token去刷新短token，这个时候就需要将存在redis里面有关长token和短token都删掉。关键是**系统**怎么拿到这些**集合**，所以就需要设置一个set集合，确保系统能够拿到所有关于该用户的token，然后逐一删掉。

# 具体实现

## 第一 需要将长短token都存入redis

**为什么我们需要将长短token都存入set集合**

在一般的操作中，我们只对长token进行缓存（如果不存长token，那么攻击者就会拿着长token刷新短token，从而继续攻击），但是这样没有办法让用户立刻下线，所以我们对短toekn也进行缓存，保证用户能够立刻下线（这是从时效性方面解释），而我们需要知道一个逻辑，就是我们一旦检测出（通过重放检测实现）用户有攻击的意图，就需要**全面封杀**，即对该用户的所有设备进行封杀（这是从统一性方面解释）。

```java
if(检测到攻击的意图){
  系统就知道，这个用户不怀好意，应该全面封杀
}
```
所以我们应该在set集合中把长token和短token都存入。

>所以set集合的最终目的是为了建立一个userId对多个tokenId的关系表，通过userId查找出所有的tokenId，然后那这个这个tokenId去缓存长token和短token的地方删除这些token，他本质上就是一个清单。

## 第二 [关于set集合为什么需要设置过期时间和如何设置过期时间](关于set集合为什么需要设置过期时间和如何设置过期时间.md)


## 第三 set集合在 过期与复活 (Refresh) 这个阶段的不同场景的操作

三个流程
已经过期 (Natural Expiration)

[当拿着refresh_token刷新时，set集合的操作](当拿着refresh_token刷新时，set集合的操作.md)
