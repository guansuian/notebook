
---

## 一句话定义（面试版）

> **重放检测** 是指通过识别同一个令牌（通常是 Refresh Token）被重复使用的行为，来判断令牌是否被复制或盗用，从而触发安全处置的机制。


>**人话**：  
>**重放**就是一个token被使用了两次，**检测**：就是检测这个token有没有被使用多次（一般是两次）

---

## 一、为什么需要重放检测？（问题背景）

### JWT + Refresh Token 的致命风险

- Refresh Token 生命周期长
    
- 一旦被盗，攻击者可以：
    
    - 在很长时间内反复刷新 Access Token
        
    - 服务器**无法区分“本人使用”还是“攻击者使用”**
        

👉 **“被复制但还能用”** 是最危险的状态。

---

## 二、重放检测要解决的核心问题

> **同一个 Refresh Token，理论上只能被“使用一次”。**

如果：

- 同一个 refresh 被用 **第二次**
    
- 且不是因为系统错误
    

👉 **那几乎可以确定发生了盗用 / 复制（Replay）**

---

## 三、重放检测的基本思路（核心机制）

### 关键原则

> **一次性令牌（One-Time Token） + 使用痕迹记录（即能过解析，但是在白名单没有找到）**

---

### 典型做法（最常见）

1. 每个 Refresh Token 都有唯一标识 `jti`
    
2. Redis 中维护的数据：
    
    - **当前有效 refresh**（白名单）：如果白名单没有，并且还通过jwt解析，就说明这个token是被重放了
        
---

## 四、面试标准回答（30 秒）

> 重放检测是通过记录 Refresh Token 的使用痕迹，来识别同一个令牌被重复使用的行为。通常会为每个 Refresh Token 分配唯一标识，并在使用后将其标记为已使用，如果后续再次出现相同标识，就可以判定为重放，从而触发安全处置，比如全端下线或强制重新登录。这种机制常与令牌轮转一起使用，用来降低 Refresh Token 泄露后的风险。

---

