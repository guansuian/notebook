这件事稍微有点复杂，叫 **“数据权限” (Data Scope)**。

若依已经帮你封装好了“黑魔法”，你只需要按照这 **4 步** 走，就能实现“二班班主任只能看二班学生”。

这里的核心逻辑是：**把“班级”对应成系统里的“部门 (Dept)”**。

---

### 第一步：给学生表打上“部门”标签

**原理：** 数据库不知道哪个学生属于哪个班。你得加个字段。

1. **修改数据库：** 打开 `sys_student` 表，加一个字段 `dept_id` (部门ID)。
    
    SQL
    
    ```
    ALTER TABLE `sys_student` ADD COLUMN `dept_id` bigint(20) DEFAULT NULL COMMENT '部门ID（班级ID）';
    ```
    
2. **补数据：** 去数据库里，随便把几个学生的 `dept_id` 改成 `103`，几个改成 `104`（假设这是你在若依里建的两个部门ID）。
    

---

### 第二步：在 Service 层施展魔法（Java代码）

找到你的 `StudentServiceImpl.java` (注意是实现类)，找到 **查询列表** 的方法 `selectStudentList`。

你需要加一个注解 `@DataScope`。

Java

```
// StudentServiceImpl.java

@Override
@DataScope(deptAlias = "d") // <--- 加上这一行！
public List<Student> selectStudentList(Student student)
{
    return studentMapper.selectStudentList(student);
}
```

- **解释：** `deptAlias = "d"` 是告诉若依：“待会儿我在 SQL 里会把部门表起个别名叫 `d`，请你自动帮我过滤。”
    

---

### 第三步：在 XML 里埋下伏笔（SQL代码）

这是最关键的一步，也是新手最容易漏的一步。

打开 `StudentMapper.xml`。

1. **找到 `<select id="selectStudentList">`**。
    
2. **修改 SQL 语句**，做两件事：
    
    - **关联部门表：** 用 `LEFT JOIN` 把 `sys_dept` 连进来，并且起别名叫 `d`。
        
    - **添加过滤占位符：** 在 `where` 标签的最后，加上 `${params.dataScope}`。
        

**修改后的样子大致如下：**

XML

```
<select id="selectStudentList" parameterType="Student" resultMap="StudentResult">
    select s.student_id, s.student_name, s.dept_id, ... 
    from sys_student s
    left join sys_dept d on s.dept_id = d.dept_id  <where>  
        <if test="studentName != null ..."> ... </if>
        
        ${params.dataScope}
    </where>
</select>
```

---

### 第四步：去后台配置角色（不用写代码）

代码改好了，重启后端项目。

1. 登录管理员账号 `admin`。
    
2. 去 **【系统管理】 -> 【角色管理】**。
    
3. 找到你创建的 **“老师”** 角色，点击这一行右边的 **“数据权限”**（一个小数据库图标，不是“修改”按钮，是在“更多”或者是单独的图标）。
    
4. **权限范围**：选择 **“本部门数据权限”**。
    
5. 点确定。
    

---

### 见证奇迹的时刻

1. **假设：** 你把用户 `teacher_li` 分配到了 **“研发部门”**（在用户管理里改）。
    
2. **假设：** 你的学生表里，只有张三的 `dept_id` 是研发部门的 ID，李四是其他部门的。
    
3. **操作：**
    
    - 用 `teacher_li` 登录。
        
    - 打开学生列表。
        
4. **结果：** 他只能看到张三，**李四凭空消失了**。
    

---

### 它是怎么做到的？（原理揭秘）

当你执行查询时，若依的 AOP（面向切面编程）拦截到了 `@DataScope` 注解。

它发现当前登录的 `teacher_li` 是“本部门权限”，于是它悄悄修改了你的 SQL。

**原本的 SQL：**

`SELECT * FROM sys_student s ...`

**被若依修改后的 SQL（实际执行的）：**

`SELECT * FROM sys_student s LEFT JOIN sys_dept d ... WHERE ... AND d.dept_id = 103`

那句 `${params.dataScope}` 就是若依注入 SQL 的入口。

**快去试试吧！做完这一步，你就可以跟老板说：我不光懂 CRUD，我还懂企业级的数据安全设计。**